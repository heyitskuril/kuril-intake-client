generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(uuid())
  name       String
  email      String   @unique
  password   String
  role       UserRole @default(viewer)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  internal_notes InternalNote[]
  activity_logs  ActivityLog[]

  @@map("users")
}

enum UserRole {
  admin // Full access
  assistant // Read + comment
  viewer // Read only
}

model Client {
  id             String       @id @default(uuid())
  name           String
  email          String
  business_type  String?
  service_type   String?
  budget         Decimal?     @db.Decimal(15, 2)
  notes          String?      @db.Text
  attachment_url String?
  form_data      Json? // Stores dynamic form responses
  status         ClientStatus @default(new)
  created_at     DateTime     @default(now())
  updated_at     DateTime     @updatedAt

  internal_notes InternalNote[]
  activity_logs  ActivityLog[]

  @@index([status])
  @@index([created_at])
  @@index([email])
  @@map("clients")
}

enum ClientStatus {
  new
  in_progress
  completed
  rejected
  archived
}

model Service {
  id             String   @id @default(uuid())
  name           String
  description    String   @db.Text
  slug           String   @unique
  min_price      Decimal  @db.Decimal(15, 2)
  max_price      Decimal  @db.Decimal(15, 2)
  estimated_days Int
  features       Json // Array of features included
  is_active      Boolean  @default(true)
  display_order  Int      @default(0)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@index([is_active])
  @@index([display_order])
  @@map("services")
}

model FormField {
  id               String    @id @default(uuid())
  field_name       String
  field_label      String
  field_type       FieldType
  placeholder      String?
  help_text        String?
  is_required      Boolean   @default(false)
  options          Json?
  validation_rules Json?
  display_order    Int       @default(0)
  is_active        Boolean   @default(true)
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt

  @@index([is_active])
  @@index([display_order])
  @@map("form_fields")
}

enum FieldType {
  text
  textarea
  email
  number
  select
  radio
  checkbox
  date
  file
}

model BrandingSetting {
  id          String   @id @default(uuid())
  key         String   @unique
  value       String   @db.Text
  category    String // "visual", "content", "seo"
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@index([category])
  @@map("branding_settings")
}

model Announcement {
  id         String    @id @default(uuid())
  title      String
  message    String    @db.Text
  type       String    @default("info")
  is_active  Boolean   @default(true)
  priority   Int       @default(0)
  start_date DateTime?
  end_date   DateTime?
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt

  @@index([is_active])
  @@index([priority])
  @@map("announcements")
}

model InternalNote {
  id         String   @id @default(uuid())
  client_id  String
  user_id    String
  note       String   @db.Text
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  client Client @relation(fields: [client_id], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [user_id], references: [id])

  @@index([client_id])
  @@index([user_id])
  @@map("internal_notes")
}

model ActivityLog {
  id          String         @id @default(uuid())
  user_id     String?
  action      ActivityAction
  target_type String?
  target_id   String?
  metadata    Json?
  ip_address  String?
  user_agent  String?
  created_at  DateTime       @default(now())

  user   User?   @relation(fields: [user_id], references: [id])
  client Client? @relation(fields: [target_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([action])
  @@index([created_at])
  @@map("activity_logs")
}

enum ActivityAction {
  client_created
  client_updated
  status_changed
  note_added
  note_updated
  note_deleted
  user_created
  user_updated
  user_deleted
  announcement_created
  announcement_updated
  settings_updated
  service_created
  service_updated
  service_deleted
  form_field_created
  form_field_updated
  form_field_deleted
  branding_updated
  login
  logout
}
